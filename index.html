<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" media="screen" href="style.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

</head>
<body>
    <div id = "mainBox">
    <div id = "map">
        <div id="boxName">
            <ul>
                    <li><i class="fas fa-signature"></i></li>
                    <li> <input type="text" maxlength="11" name="" id="textName"></li>
                    <li><input type="button" id="addName" value="Add"></i></li>
                </ul>
        </div>
        <div id="boxMarkerSrc">
            <ul>
                <li><i class="fas fa-map-marker"></i></li>
                <li> <input type="text" name=""  id="avatarSrc"></li>
                <li><input type="button" id="addAvatar" value="Add"></i></li>
            </ul>
           
        </div>
        <div id = "mapView"></div>
        <div id = "position">
            <ul>
                <li> <h5>x = </h6>  <p id="Lat"> </p> </li>
                <li> <h5>y = </h6> <p id="Lng"> </p></li>
            </ul>

        </div>
        <div id = "nick"> <p>Anonimus</p> </div>
    </div>
    <div id = "czat">ds</div>
    </div>
</body>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARkS-dsh-7IirtcQg3oSZEHudV6Uw9Iic&callback=mapaStart" async
        defer>
</script>
<script>

let marker;
let position;
let map;
let nick;
let markerSrc;

//funkcja odpowiedzialna za poruszanie markerem za pomocą przucisków w,a,s,d
document.addEventListener("keydown" , (e)=>
{
    
    switch(e.keyCode)
    {
        case 87:   position.lat+=0.05;
        break;
        case 83:  position.lat-=0.05;
        break;
        case 68:  position.lng+=0.05;
        break;
        case 65:  position.lng-=0.05;
        break;
        break;
        
    }
    marker.setPosition( position );
    map.setCenter(position);
    displayPosition();
})
// funkcja odpowiedzialna za przesuwanie markera za pomocą myszki
document.querySelector("#mapView").addEventListener("mousemove",(e)=>
    {
        
    }
    

)

//funkcja dodajoca nick gracza 
document.querySelector("#addName").addEventListener('click', (e)=>
{
    if(!document.querySelector("#textName").value==" ")
    nick= document.querySelector("#textName").value;
    else
    nick = "Anonimus";

    document.querySelector("#nick p").innerHTML = nick;

    //dodawnie niku do markera
     marker.setTitle( nick );
})


//funkcja wyswietlająca wspołrzedne
function displayPosition()
{
    document.querySelector("#Lat").innerHTML  = position.lat.toFixed(2) ;
    document.querySelector("#Lng").innerHTML  =  position.lng.toFixed(2);
}

//funkcja zmieniająca awatar
document.querySelector("#addAvatar").addEventListener('click',  ()=>{
   
    markerSrc = document.querySelector("#avatarSrc").value;
    AvatarImg = 
    {
        url: markerSrc,
        scaledSize: new google.maps.Size( 27 ,43),
        
    };
    marker.setIcon( AvatarImg );


});
/*
//Tworzymy websocket
var socket = new WebSocket("ws://achex.ca:4010");


//sprawdzmy czy webbsocket jest otwarti i wysyłamy wiadomość
socket.addEventListener('open', function(event) {
    socket.send("Here's some text that the server is urgently awaiting!"); 
});

// Listen for websocket messages.
socket.addEventListener('message', function(event) {
    var message = JSON.parse(event.data);
    if (message.accepted === true) {
        // Now you can send data, server will deliver your messages to other clients.
        socket.send(JSON.stringify({ greeting: "Hello World!", local_time: Date.now() }));
    } else {
        console.log(message); // Handle messages from other clients.
    }


});*/



// mapa /////////////////////////////////////////////////
// tworzenie i wyświetlenie mapy
function mapaStart()   
{   
    
                position = { lat: 50, lng: 50 };
                // The map, centered at position
                 map =  new google.maps.Map(document.querySelector("#mapView"),
                    {
                        zoom: 5,
                        center: position,
                        styles: [ { "elementType": "labels", "stylers": [ { "visibility": "off" }, { "color": "#f49f53" } ] }, { "featureType": "landscape", "stylers": [ { "color": "#f9ddc5" }, { "lightness": -7 } ] }, { "featureType": "road", "stylers": [ { "color": "#813033" }, { "lightness": 43 } ] }, { "featureType": "poi.business", "stylers": [ { "color": "#645c20" }, { "lightness": 38 } ] }, { "featureType": "water", "stylers": [ { "color": "#1994bf" }, { "saturation": -69 }, { "gamma": 0.99 }, { "lightness": 43 } ] }, { "featureType": "road.local", "elementType": "geometry.fill", "stylers": [ { "color": "#f19f53" }, { "weight": 1.3 }, { "visibility": "on" }, { "lightness": 16 } ] }, { "featureType": "poi.business" }, { "featureType": "poi.park", "stylers": [ { "color": "#645c20" }, { "lightness": 39 } ] }, { "featureType": "poi.school", "stylers": [ { "color": "#a95521" }, { "lightness": 35 } ] }, {}, { "featureType": "poi.medical", "elementType": "geometry.fill", "stylers": [ { "color": "#813033" }, { "lightness": 38 }, { "visibility": "off" } ] }, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, { "elementType": "labels" }, { "featureType": "poi.sports_complex", "stylers": [ { "color": "#9e5916" }, { "lightness": 32 } ] }, {}, { "featureType": "poi.government", "stylers": [ { "color": "#9e5916" }, { "lightness": 46 } ] }, { "featureType": "transit.station", "stylers": [ { "visibility": "off" } ] }, { "featureType": "transit.line", "stylers": [ { "color": "#813033" }, { "lightness": 22 } ] }, { "featureType": "transit", "stylers": [ { "lightness": 38 } ] }, { "featureType": "road.local", "elementType": "geometry.stroke", "stylers": [ { "color": "#f19f53" }, { "lightness": -10 } ] }, {}, {}, {} ],
                        disableDefaultUI: true,
	                    zoomControl: true,
                        
                    });

                marker = new google.maps.Marker({position: position, map: map ,animation: google.maps.Animation.DROP,})

}   



</script>


</html>